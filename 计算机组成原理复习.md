# 第三章
## 存储器概述
### 存储器的分类
- 存储介质 
    1. 半导体存储器
    2. 磁表面存储器
- 存取方式
    1. 随机存储器：乱存取
    2. 顺序存储器：存取时间和物理位置有关
- 存储内容可变性
    1. 只读存储器ROM
    2. 随机读写存储器RAM
- 信息易失性
- 系统中的作用
###### 半导体存储器的存储类型

存储器类型 | 存储器 
---|---
随机存储器 | RAM
只读存储器 | ROM
可编程|PROM 
光擦可编程|EPROM
电擦可编程|EEPROM

### 存储器的分级
1. 高速缓冲存储器
2. 主存储器
3. 外存储器

### 主存储器的技术指标
1. 存储容量
2. 存取时间
3. 存储周期
4. 存储器带宽

## SRAM存储器(static ram)
- 优点：存取速度快
- 缺点：存储容量小
- 所有的SRAM的特征是用一个锁存器（触发器）作为存储元 断电数据丢失
- 所有的SRAM都有三组信号线：
    - 地址线
    - 数据线
    - 控制线
- 目前的SRAM采用双译码方式
- CS(chip select)片选
- WE(write enable)写入有效
- OE(output enable)输出有效
- 加了上划线是说低有效

## DRAM存储器(dynamic ram)
- 存储元：MOS晶体管+电容 组成的记忆电路 存储信息1或0是由电容器上的电荷量来体现
- 读出过程也是刷新过程
- 与SRAM不同的是
    - 增加了行地址锁存器和列地址锁存器
        1. 行选通信号RAS
        2. 列选通信号CAS
    - 增加了刷新计数器和相应的控制电路
- 刷新周期：DRAM必须实时刷新(8ms/16ms)
    - 集中式刷新
        1. 每一行在同一个刷新周期全部刷新
    - 分散式刷新
        1. 将每一行的刷新周期插入正常的W/R周期中去
        2. 这会增加读写周期的时间，但是会避免CPU死时间
        3. 刷新周期远小于8ms，造成浪费
    - 没讲的异步刷新
        1. 刷新周期8ms/rows
        2. 会造成一定的CPU死时间，但是分散不集中，造成的影响较小
        3. 更像是前两者的妥协，使用比较广泛
- 存储器容量的扩充
    - 字长位数扩展
        1. 输出总线分成几部分与各个芯片相连
    - 字存储容量扩展
        1. 最后n位地址线作为片选

## 并行存储器
- 为了提高**cpu和主存之间的数据传输率**，除了主存采用更高速的技术来缩短读出时间外，还可以采用并行技术的存储器
- 双端存储器
- 多模块交叉存储器
    - 顺序方式
    - 交叉方式
    - **计算题**
    - T是存储周期，τ是总线传送周期，m是交叉存取度，t1是交叉存取读取m个字的时间，t2是顺序存取...W是带宽
    ```math
    T=m\tau
    
    m=T/\tau
    
    t1 = T + (m - 1)\tau
    
    t2 = mT
    
    W1 = q/t1
    
    W2 = q/t2
    ```

## cache存储器
- cache 是一种高速缓冲存储器，是为了解决**CPU和主存之间速度不匹配**而采用的技术，SRAM组成
- CPU与cache之间的数据交换是以**字**为单位的，而cache与主存之间的数据交换是以**块**为单位的，一个块由若干字组成，是定长的
- **cache命中率**
    - **计算题**
    - h命中率，Nc是cache完成的读写次数，Nm是主存，tc是cache访问时间，tm是主存
    ```math
    h = \frac{N_c}{N_c+N_m}
    ```
    - 平均访问时间
    ```math
    t_a=ht_c+(1-h)t_m
    ```
    - 访问效率
	<a href="https://www.codecogs.com/eqnedit.php?latex=e=\frac{t_c}{t_a}=\frac{t_c}{ht_c&plus;(1-h)t_m}=\frac{1}{h&plus;(1-h)r}=\frac{1}{r&plus;(1-r)h}" target="_blank"><img src="https://latex.codecogs.com/gif.latex?e=\frac{t_c}{t_a}=\frac{t_c}{ht_c&plus;(1-h)t_m}=\frac{1}{h&plus;(1-h)r}=\frac{1}{r&plus;(1-r)h}" title="e=\frac{t_c}{t_a}=\frac{t_c}{ht_c+(1-h)t_m}=\frac{1}{h+(1-h)r}=\frac{1}{r+(1-r)h}" /></a>
    $$r=t_m/t_c$$
    
    
    
- **主存与cache的地址映射**
    - cache中的数据块大小叫行 主存中的数据块大小叫块 
    - i行号 j块号 m行数 n块数 k每个块的字数
    ```math
    m=2^r;n=2^s;k=2^w
    ```
    - 全相连映射
        1. 直接将块地址存在cache中作为tag
        2. 标记：主存中的块地址 s位
        3. 非常灵活 但是比较器电路难以实现 适合小容量
        4. 主存地址长度=(s+w) 寻址单元数=2^w 标记大小=s
    - 直接映射
        1. 类似哈希表将多个主存块与一个cache行进行映射
        2. 标记：主存中的块地址减去cache中的行地址 s-r位
        3. 硬件简单 成本低 但是每个主存块有一个固定存储位置 容易冲突
        4. 主存地址长度=(s-r + r +w) 寻址单元数=2^(s+w) 标记大小=s-r
    - 组相连映射
        1. 类似哈希表将多个主存块与一个cache行进行映射
        2. 标记：主存中的块地址减去每组的行数 s-d位
        3. 综合两种的优缺点
        4. 主存地址长度=(s-d + d +w) 寻址单元数=2^(s+w) 标记大小=s-r
- 替换策略
    - 最不常用(LFU)算法
        1. 访问则计数器+1 满了以后将访问次数最少的换出 并置零
    - 近期最少使用(LRU)算法
        1. 访问则其他人+1 它置零 满了以后将最大的换出
    - 随机替换不算算法
- cache的写操作策略
    - 写回法
        1. 只有某行被换出时才写主存 不能保持cache和主存的一致性
    - 全写法
        1. 写入操作不缓存 保持一致性
    - 写一次法
        1. 第一次写的时候同步所有cache 保持所有cache的一致性

## 虚拟存储器
- 程序所需的存储器容量与计算机系统实际配备的主存储器容量之间存在矛盾
- 多用户多任务共享内存的时候需要动态分配内存
- 希望在写程序的时候不考虑 物理存储器的大小 物理存储器的地址 在运行时动态分配
- 编程时使用的地址叫**虚地址(逻辑地址)** 计算机内存的地址叫**实地址(物理地址)**
- cache与虚存的异同
    - 出发点相同
    - 原理相同
    - 侧重点不同
    - 数据通路不同 cpu与辅存不互通
    - 透明性不同 cache是完全透明的
    - 未命中时的损失不同 主存未命中的损失大的多
- 页式虚拟存储器
    - 页式虚存地址映射
        1. 虚存地址被分为等长的页(逻辑页)主存也被分为等长的页(物理页)
        2. 每个进程对应一个页表
        3. 优点：长度固定 便于构造 易于管理
        4. 缺点：和程序逻辑大小不相关 操作麻烦
    - 转换后援缓冲器(TLB)
        - 对页表本身进行二级缓存 降低访存延迟
        - 块表和慢表
        - 类似cache
- 段式虚拟存储器
    - 根据程序的逻辑长度分段
    - 优点：易于管理 段长自由 
    - 缺点：主存空间分配麻烦 需要更多的硬件支持
- 段页式虚拟存储器
    - 先按照逻辑结构进行分段 再对每一段进行分页
    - 优点：按页进行调入调出 易于管理 按段进行编程、保护和共享
    - 缺点：多次查表 复杂度高

# 第六章 总线系统
## 总线
- 总线：构成计算机系统的互联机构，是多个系统功能部件之间进行数据传送的公共通路
- 单处理器系统的总线分为三类：
    - 内部总线：CPU内部连接各寄存器及运算部件
    - 系统总线：CPU同计算机系统的其他高速功能部件，如存储器、通道等相互连接的总线
    - I/O总线：中低速I/O设备之间互相连接的总线
- 总线标准化：没什么好说的，就是大家用一样的标准才能兼容
- 总线带宽：总线本身能达到的最高传输速率MB/s
- 总线的连接方式：
    - 接口(适配器)：实现高速CPU和低速设备之间工作速度上的匹配和同步
    - 桥：连接高速总线和低速总线的具有缓冲、转换、控制功能的逻辑电路
    - 单总线结构：信息传送效率和吞吐量受限 容易扩展成多CPU系统
    - 多总线结构：见课本图
- 总线内部结构
    - 数据传送总线
        1. 地址线
        2. 数据线
        3. 控制线
    - 仲裁总线 总线请求线 总线仲裁线
    - 中断和同步总线
    - 公用线 各种乱七八糟的线
- 总线接口
    - 信息传送方式
        1. 串行传送：一条传输线 脉冲传送
        2. 并行传送：数据由几位构成就有几根线
        3. 分时传送：总线复用 部件分时
    - 总线上的信息传送方式是**并行传送**
    - 





# 第七章 外存与I/O设备

# 第八章 输入输出系统

## 信息交换方式

### 信息查询方式

### 程序中断方式

### 直接内存访问(DMA)方式

### 通道方式

